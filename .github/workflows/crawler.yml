name: Daily Crawler

on:
  workflow_dispatch:
  schedule:
    - cron: '50 22 * * *'  # 매일 KST 오전 7시 50분에 실행

jobs:
  crawl:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Seoul   # ✅ 시간대를 KST로 설정

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: pip install -r requirements.txt

    - name: Set up environment variables
      run: |
        echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> $GITHUB_ENV
        echo "SUPABASE_KEY=${{ secrets.SUPABASE_KEY }}" >> $GITHUB_ENV
        echo "SMTP_USER=${{ secrets.SMTP_USER }}" >> $GITHUB_ENV
        echo "SMTP_PASSWORD=${{ secrets.SMTP_PASSWORD }}" >> $GITHUB_ENV
        echo "RECIPIENT_EMAIL=${{ secrets.RECIPIENT_EMAIL }}" >> $GITHUB_ENV

    - name: Install Chrome
      uses: browser-actions/setup-chrome@latest
      with:
        chrome-version: stable

    - name: Verify Chrome installation
      run: |
        google-chrome --version || chrome --version || true

    - name: Run crawler
      run: python mk_crawler.py
 